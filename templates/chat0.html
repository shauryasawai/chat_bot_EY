<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tata Capital - AI Loan Assistant</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap");

      :root {
        --tata-red: #a6192e;
        --tata-blue: #003865;
        --ey-yellow: #ffe600;
        --tech-cyan: #00f2ff;
        --glass-white: rgba(255, 255, 255, 0.95);
        --glass-border: rgba(255, 255, 255, 0.2);
        --msg-user-bg: linear-gradient(135deg, #003865 0%, #005a9e 100%);
        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
        --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.12);
        --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.16);
        --shadow-xl: 0 16px 48px rgba(0, 0, 0, 0.24);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 16px;
        color: #1a1a1a;
        background: #f5f7fa;
        position: relative;
        overflow: hidden;
      }

      .chat-container {
        width: 100%;
        max-width: 900px;
        height: 92vh;
        max-height: 800px;
        background: var(--glass-white);
        backdrop-filter: blur(40px) saturate(180%);
        -webkit-backdrop-filter: blur(40px) saturate(180%);
        border-radius: 24px;
        box-shadow: var(--shadow-xl), 0 0 0 1px rgba(255, 255, 255, 0.5),
          inset 0 1px 0 rgba(255, 255, 255, 0.9);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        position: relative;
        z-index: 1;
        transform: translateY(0);
        animation: containerFadeIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      @keyframes containerFadeIn {
        from {
          opacity: 0;
          transform: translateY(30px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .chat-header {
        background: linear-gradient(135deg, var(--tata-red) 0%, #8b1428 100%);
        color: white;
        padding: 24px 28px;
        position: relative;
        box-shadow: 0 4px 20px rgba(166, 25, 46, 0.4);
        z-index: 10;
      }

      .chat-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          135deg,
          transparent 0%,
          rgba(255, 255, 255, 0.1) 100%
        );
        pointer-events: none;
      }

      .chat-header::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(
          90deg,
          var(--tata-red) 0%,
          var(--ey-yellow) 50%,
          var(--tata-red) 100%
        );
        box-shadow: 0 2px 12px rgba(255, 230, 0, 0.5);
      }

      .header-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        position: relative;
        z-index: 1;
      }

      .brand-title {
        font-size: 26px;
        font-weight: 900;
        letter-spacing: 2px;
        text-transform: uppercase;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        background: linear-gradient(to right, #fff, #f0f0f0);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .team-badge {
        font-size: 10px;
        background: rgba(255, 255, 255, 0.2);
        padding: 6px 14px;
        border-radius: 20px;
        font-weight: 700;
        border: 1.5px solid rgba(255, 255, 255, 0.4);
        display: flex;
        align-items: center;
        gap: 6px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .team-badge::before {
        content: "‚óè";
        color: var(--ey-yellow);
        font-size: 12px;
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.6;
          transform: scale(0.8);
        }
      }

      .header-subtitle {
        font-size: 14px;
        opacity: 0.95;
        font-weight: 500;
        margin-bottom: 12px;
        position: relative;
        z-index: 1;
      }

      .sub-header-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 11px;
        opacity: 0.85;
        font-weight: 500;
        position: relative;
        z-index: 1;
      }

      .messages-container {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        padding: 28px;
        background: linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%);
        scroll-behavior: smooth;
        position: relative;
      }

      .messages-container::-webkit-scrollbar {
        width: 6px;
      }

      .messages-container::-webkit-scrollbar-track {
        background: transparent;
      }

      .messages-container::-webkit-scrollbar-thumb {
        background: linear-gradient(
          to bottom,
          var(--tata-blue),
          var(--tata-red)
        );
        border-radius: 10px;
      }

      .message {
        margin-bottom: 24px;
        display: flex;
        gap: 12px;
        opacity: 0;
        animation: slideInFade 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      }

      @keyframes slideInFade {
        from {
          opacity: 0;
          transform: translateY(20px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .message.agent {
        justify-content: flex-start;
      }

      .message.user {
        justify-content: flex-end;
      }

      .message-content {
        max-width: 75%;
        padding: 16px 22px;
        border-radius: 20px;
        line-height: 1.6;
        font-size: 15px;
        font-weight: 500;
        position: relative;
        box-shadow: var(--shadow-sm);
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      .message-content:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .agent .message-content {
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        color: #2c3e50;
        border-bottom-left-radius: 6px;
        border: 1px solid rgba(0, 0, 0, 0.06);
      }

      .user .message-content {
        background: var(--msg-user-bg);
        color: white;
        border-bottom-right-radius: 6px;
        box-shadow: 0 4px 16px rgba(0, 56, 101, 0.3);
      }

      /* Upload Section */
      .upload-section {
        padding: 24px 28px;
        background: linear-gradient(to bottom, #ffffff, #f8f9fa);
        border-top: 2px solid rgba(0, 56, 101, 0.1);
        display: none;
        box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.08);
        position: relative;
      }

      .upload-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 3px;
        background: linear-gradient(
          to right,
          transparent,
          var(--tata-blue),
          transparent
        );
        border-radius: 2px;
      }

      .upload-section.active {
        display: block;
        animation: slideUpFade 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      @keyframes slideUpFade {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .upload-label {
        font-weight: 800;
        color: var(--tata-red);
        margin-bottom: 16px;
        display: block;
        font-size: 16px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .upload-area {
        border: 2px dashed #d1d5db;
        border-radius: 16px;
        padding: 40px 20px;
        text-align: center;
        background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        position: relative;
        overflow: hidden;
      }

      .upload-area::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: radial-gradient(
          circle,
          rgba(0, 56, 101, 0.05),
          transparent
        );
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: all 0.5s ease;
      }

      .upload-area:hover {
        border-color: var(--tata-blue);
        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 56, 101, 0.15);
      }

      .upload-area:hover::before {
        width: 300px;
        height: 300px;
      }

      .upload-icon {
        font-size: 56px;
        margin-bottom: 12px;
        filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.1));
        animation: floatIcon 3s ease-in-out infinite;
      }

      @keyframes floatIcon {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      #uploadText {
        font-size: 16px;
        margin-bottom: 8px;
        color: #374151;
        font-weight: 600;
      }

      #uploadHint {
        font-size: 13px;
        color: #9ca3af;
        margin-top: 6px;
        font-weight: 500;
      }

      #fileInput {
        display: none;
      }

      .camera-container {
        display: none;
        position: relative;
        width: 100%;
        max-width: 480px;
        margin: 0 auto;
        border-radius: 16px;
        overflow: hidden;
        background: #000;
        border: 3px solid var(--tata-blue);
        box-shadow: 0 12px 40px rgba(0, 56, 101, 0.4),
          0 0 0 1px rgba(255, 255, 255, 0.1);
      }

      .camera-container.active {
        display: block;
        animation: zoomIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      @keyframes zoomIn {
        from {
          opacity: 0;
          transform: scale(0.8);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      video#cameraFeed {
        width: 100%;
        height: auto;
        display: block;
        transform: scaleX(-1);
      }

      canvas#cameraCanvas {
        display: none;
      }

      .camera-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 10;
        background: radial-gradient(
          circle,
          transparent 30%,
          rgba(0, 0, 0, 0.4) 100%
        );
      }

      .face-guide {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 200px;
        height: 250px;
        border: 3px dashed var(--ey-yellow);
        border-radius: 50% 50% 40% 40%;
        opacity: 0.8;
        animation: guideBreathing 2s ease-in-out infinite;
        box-shadow: 0 0 20px rgba(255, 230, 0, 0.5);
      }

      @keyframes guideBreathing {
        0%,
        100% {
          transform: translate(-50%, -50%) scale(1);
        }
        50% {
          transform: translate(-50%, -50%) scale(1.05);
        }
      }

      .preview-container {
        margin-top: 20px;
        display: none;
        position: relative;
        border-radius: 12px;
        overflow: hidden;
        width: fit-content;
        margin-left: auto;
        margin-right: auto;
        border: 2px solid var(--tata-blue);
        box-shadow: var(--shadow-md);
      }

      .preview-container.active {
        display: block;
        animation: fadeInScale 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      @keyframes fadeInScale {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .preview-image {
        max-width: 100%;
        max-height: 240px;
        display: block;
      }

      .scanner-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          to bottom,
          rgba(0, 242, 255, 0.3),
          transparent 10%
        );
        border-bottom: 3px solid var(--tech-cyan);
        display: none;
        z-index: 5;
        box-shadow: 0 0 20px rgba(0, 242, 255, 0.6);
      }

      .scanning .scanner-overlay {
        display: block;
        animation: scanDocument 2s ease-in-out infinite;
      }

      @keyframes scanDocument {
        0% {
          transform: translateY(-100%);
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
        100% {
          transform: translateY(100%);
          opacity: 0;
        }
      }

      .action-buttons {
        display: flex;
        gap: 12px;
        margin-top: 20px;
      }

      .upload-btn,
      .camera-btn {
        flex: 1;
        background: linear-gradient(135deg, var(--tata-blue) 0%, #002a4d 100%);
        color: white;
        border: none;
        padding: 16px 24px;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 700;
        cursor: pointer;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        box-shadow: 0 4px 16px rgba(0, 56, 101, 0.3);
        position: relative;
        overflow: hidden;
      }

      .upload-btn::before,
      .camera-btn::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }

      .upload-btn:hover::before,
      .camera-btn:hover::before {
        width: 300px;
        height: 300px;
      }

      .upload-btn:hover:not(:disabled),
      .camera-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 24px rgba(0, 56, 101, 0.4);
      }

      .upload-btn:active:not(:disabled),
      .camera-btn:active {
        transform: translateY(-1px);
      }

      .upload-btn:disabled {
        background: linear-gradient(135deg, #9ca3af, #6b7280);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .secondary-btn {
        background: transparent;
        border: 2px solid var(--tata-blue);
        color: var(--tata-blue);
        box-shadow: none;
      }

      .secondary-btn:hover {
        background: linear-gradient(135deg, #eff6ff, #dbeafe);
        border-color: #002a4d;
        color: #002a4d;
      }

      /* Input Section */
      .input-section {
        padding: 24px 28px;
        background: linear-gradient(to top, #ffffff, #f8f9fa);
        border-top: 1px solid rgba(0, 0, 0, 0.06);
        box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.04);
      }

      .input-container {
        display: flex;
        gap: 12px;
      }

      #messageInput {
        flex: 1;
        padding: 16px 24px;
        border: 2px solid #e5e7eb;
        border-radius: 14px;
        font-size: 15px;
        font-weight: 500;
        outline: none;
        transition: all 0.3s ease;
        background: #ffffff;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.03);
      }

      #messageInput:focus {
        border-color: var(--tata-blue);
        background: #ffffff;
        box-shadow: 0 0 0 4px rgba(0, 56, 101, 0.1),
          inset 0 2px 4px rgba(0, 0, 0, 0.03);
        transform: translateY(-2px);
      }

      #sendBtn {
        background: linear-gradient(135deg, var(--tata-red) 0%, #8b1428 100%);
        color: white;
        border: none;
        padding: 0 36px;
        border-radius: 14px;
        font-size: 15px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        box-shadow: 0 4px 16px rgba(166, 25, 46, 0.3);
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
        overflow: hidden;
      }

      #sendBtn::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }

      #sendBtn:hover::before {
        width: 300px;
        height: 300px;
      }

      #sendBtn:hover:not(:disabled) {
        transform: translateY(-3px);
        box-shadow: 0 8px 24px rgba(166, 25, 46, 0.4);
      }

      #sendBtn:active:not(:disabled) {
        transform: translateY(-1px);
      }

      #sendBtn:disabled {
        background: linear-gradient(135deg, #9ca3af, #6b7280);
        cursor: not-allowed;
        box-shadow: none;
      }

      .verification-status {
        padding: 16px 20px;
        margin: 12px 0;
        border-radius: 14px;
        font-size: 14px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 12px;
        animation: slideInFade 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        box-shadow: var(--shadow-sm);
      }

      .verification-status.success {
        background: linear-gradient(135deg, #d1fae5, #a7f3d0);
        color: #065f46;
        border: 2px solid #10b981;
      }

      .verification-status.error {
        background: linear-gradient(135deg, #fee2e2, #fecaca);
        color: #991b1b;
        border: 2px solid #ef4444;
      }

      .typing-indicator {
        display: none;
        padding: 16px;
        margin-left: 12px;
      }

      .typing-indicator.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .typing-dots {
        display: flex;
        gap: 6px;
      }

      .typing-dots span {
        display: inline-block;
        width: 10px;
        height: 10px;
        background: linear-gradient(135deg, var(--tata-blue), var(--tata-red));
        border-radius: 50%;
        animation: typingBounce 1.4s infinite ease-in-out;
        box-shadow: 0 2px 8px rgba(0, 56, 101, 0.3);
      }

      .typing-dots span:nth-child(1) {
        animation-delay: 0s;
      }
      .typing-dots span:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-dots span:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typingBounce {
        0%,
        60%,
        100% {
          transform: translateY(0);
          opacity: 0.6;
        }
        30% {
          transform: translateY(-12px);
          opacity: 1;
        }
      }

      .footer-credit {
        text-align: center;
        padding-top: 12px;
        font-size: 11px;
        color: #9ca3af;
        font-weight: 500;
      }

      .loan-approved {
        text-align: center;
        padding: 36px 28px;
        background: linear-gradient(135deg, #ffffff 0%, #d1fae5 100%);
        color: #065f46;
        border-radius: 20px;
        margin: 24px 0;
        border: 2px solid #10b981;
        position: relative;
        box-shadow: 0 8px 32px rgba(16, 185, 129, 0.2);
        animation: celebrationPulse 2s ease-in-out infinite;
      }

      @keyframes celebrationPulse {
        0%,
        100% {
          box-shadow: 0 8px 32px rgba(16, 185, 129, 0.2);
        }
        50% {
          box-shadow: 0 12px 40px rgba(16, 185, 129, 0.4);
        }
      }

      .loan-approved h3 {
        font-size: 24px;
        font-weight: 900;
        margin-bottom: 12px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .loan-approved p {
        font-size: 15px;
        margin-bottom: 20px;
        font-weight: 600;
      }

      .download-btn {
        background: linear-gradient(135deg, var(--tata-blue) 0%, #002a4d 100%);
        color: white;
        border: none;
        padding: 14px 32px;
        border-radius: 12px;
        font-weight: 700;
        cursor: pointer;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        font-size: 15px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        box-shadow: 0 4px 16px rgba(0, 56, 101, 0.3);
      }

      .download-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 24px rgba(0, 56, 101, 0.4);
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        body {
          padding: 8px;
        }

        .chat-container {
          height: 100vh;
          max-height: none;
          border-radius: 16px;
        }

        .chat-header {
          padding: 18px 20px;
        }

        .brand-title {
          font-size: 20px;
        }

        .team-badge {
          font-size: 9px;
          padding: 5px 10px;
        }

        .header-subtitle {
          font-size: 12px;
        }

        .sub-header-info {
          font-size: 10px;
        }

        .messages-container {
          padding: 20px 16px;
        }

        .message-content {
          max-width: 85%;
          padding: 14px 18px;
          font-size: 14px;
        }

        .upload-section {
          padding: 20px 16px;
        }

        .upload-area {
          padding: 32px 16px;
        }

        .upload-icon {
          font-size: 48px;
        }

        #uploadText {
          font-size: 14px;
        }

        .camera-container {
          max-width: 100%;
        }

        .action-buttons {
          flex-direction: column;
          gap: 10px;
        }

        .upload-btn,
        .camera-btn {
          padding: 14px 20px;
          font-size: 13px;
        }

        .input-section {
          padding: 16px;
        }

        #messageInput {
          padding: 14px 20px;
          font-size: 14px;
        }

        #sendBtn {
          padding: 0 24px;
          font-size: 14px;
        }

        .loan-approved {
          padding: 28px 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="chat-container">
      <div class="chat-header">
        <div class="header-top">
          <div class="brand-title">TATA CAPITAL</div>
          <div class="team-badge">EY Technothon 6.0</div>
        </div>
        <p style="font-size: 14px; opacity: 0.9">
          AI-Powered KYC & Loan Processing
        </p>
        <div class="sub-header-info">
          <span>By Team Code Crushers</span>
          <span>üîí Secure Connection</span>
        </div>
      </div>

      <div class="messages-container" id="messagesContainer">
        <div class="typing-indicator" id="typingIndicator">
          <div class="typing-dots"><span></span><span></span><span></span></div>
        </div>
      </div>

      <div class="upload-section" id="uploadSection">
        <label class="upload-label" id="uploadLabel">üì§ Upload Document</label>

        <div class="upload-area" id="uploadArea">
          <div class="upload-icon" id="uploadIcon" style="font-size: 48px">
            üÜî
          </div>
          <p id="uploadText">
            <strong>Click to upload</strong> or drag and drop
          </p>
          <p
            style="font-size: 13px; color: #888; margin-top: 5px"
            id="uploadHint"
          >
            JPG, PNG, or WebP
          </p>
          <input type="file" id="fileInput" accept="image/*" />
        </div>

        <div class="camera-container" id="cameraContainer">
          <video id="cameraFeed" autoplay playsinline></video>
          <canvas id="cameraCanvas"></canvas>
          <div class="camera-overlay">
            <div class="face-guide"></div>
          </div>
        </div>

        <div class="preview-container" id="previewContainer">
          <div class="scanner-overlay" id="scannerOverlay"></div>
          <img id="previewImage" class="preview-image" alt="Preview" />
        </div>

        <div class="action-buttons" id="actionButtons">
          <button class="upload-btn" id="uploadBtn" disabled>
            Upload Document
          </button>
        </div>
      </div>

      <div class="input-section">
        <div class="input-container">
          <input
            type="text"
            id="messageInput"
            placeholder="TYPE HERE..."
            autocomplete="off"
          />
          <button id="sendBtn" disabled>Send</button>
        </div>
        <div class="footer-credit">
          Powered by Team Code Crushers | EY Technothon 2025
        </div>
      </div>
    </div>

    <script>
      let sessionId = null;
      let currentUploadType = null;
      let selectedFile = null;
      let stream = null; // To store camera stream

      window.addEventListener("load", initChat);

      async function initChat() {
        showTyping();
        try {
          const response = await fetch("/start_chat/", { method: "POST" });
          const data = await response.json();
          hideTyping();
          if (data.session_id) {
            sessionId = data.session_id;
            addMessage(data.message, "agent");
            document.getElementById("sendBtn").disabled = false;
          }
        } catch (error) {
          hideTyping();
          addMessage("Failed to connect. Please refresh.", "agent");
        }
      }

      // Chat & UI Functions
      document
        .getElementById("sendBtn")
        .addEventListener("click", sendMessageHandler);
      document
        .getElementById("messageInput")
        .addEventListener("keypress", (e) => {
          if (e.key === "Enter") sendMessageHandler();
        });

      // Force uppercase input
      document.getElementById("messageInput").addEventListener("input", (e) => {
        e.target.value = e.target.value.toUpperCase();
      });

      function sendMessageHandler() {
        const input = document.getElementById("messageInput");
        const message = input.value.trim();
        if (message && sessionId) {
          sendMessage(message);
          input.value = "";
        }
      }

      async function sendMessage(message) {
        addMessage(message, "user");
        showTyping();
        try {
          const response = await fetch("/chat/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ session_id: sessionId, message: message }),
          });
          const data = await response.json();
          hideTyping();

          if (data.message) addMessage(data.message, "agent");
          if (data.requires_upload) showUploadSection(data.upload_type);
          else hideUploadSection();
          if (data.sanction_letter_url)
            showLoanApproval(data.sanction_letter_url);
        } catch (error) {
          hideTyping();
          addMessage("Error processing request.", "agent");
        }
      }

      function addMessage(text, type) {
        const container = document.getElementById("messagesContainer");
        const div = document.createElement("div");
        div.className = `message ${type}`;
        div.innerHTML = `<div class="message-content">${text}</div>`;
        container.insertBefore(div, document.getElementById("typingIndicator"));
        container.scrollTop = container.scrollHeight;
      }

      function showTyping() {
        document.getElementById("typingIndicator").classList.add("active");
        document.getElementById("messagesContainer").scrollTop =
          document.getElementById("messagesContainer").scrollHeight;
      }
      function hideTyping() {
        document.getElementById("typingIndicator").classList.remove("active");
      }

      /* --- UPLOAD & CAMERA LOGIC --- */
      const uploadArea = document.getElementById("uploadArea");
      const fileInput = document.getElementById("fileInput");
      const previewContainer = document.getElementById("previewContainer");
      const previewImage = document.getElementById("previewImage");
      const cameraContainer = document.getElementById("cameraContainer");
      const video = document.getElementById("cameraFeed");
      const canvas = document.getElementById("cameraCanvas");
      const actionButtons = document.getElementById("actionButtons");

      uploadArea.addEventListener("click", () => fileInput.click());
      fileInput.addEventListener("change", (e) =>
        handleFileSelect(e.target.files[0])
      );

      function handleFileSelect(file) {
        if (!file) return;
        selectedFile = file;
        const reader = new FileReader();
        reader.onload = (e) => {
          previewImage.src = e.target.result;
          previewContainer.classList.add("active");
          // If camera was active, hide it
          stopCamera();
          cameraContainer.classList.remove("active");
          uploadArea.style.display = "none";
        };
        reader.readAsDataURL(file);
        renderButtons("upload");
      }

      function showUploadSection(uploadType) {
        currentUploadType = uploadType;
        document.getElementById("uploadSection").classList.add("active");
        resetUploadUI();

        const config = {
          pan_card: { label: "Upload PAN Card", icon: "üÜî" },
          selfie: { label: "Take Live Selfie", icon: "ü§≥" },
          salary_slip: { label: "Upload Salary Slip", icon: "üìÑ" },
        };

        const settings = config[uploadType] || config["pan_card"];
        document.getElementById("uploadLabel").textContent = settings.label;
        document.getElementById("uploadIcon").textContent = settings.icon;

        // If Selfie, prioritize Camera UI
        if (uploadType === "selfie") {
          document.getElementById("uploadText").innerHTML =
            "<strong>Click to Start Camera</strong><br>or upload existing photo";
          renderButtons("start_camera");
        } else {
          renderButtons("default");
        }
      }

      function renderButtons(state) {
        actionButtons.innerHTML = ""; // Clear buttons

        if (state === "default") {
          // Standard File Upload Button
          const btn = document.createElement("button");
          btn.className = "upload-btn";
          btn.textContent = "Select File";
          btn.onclick = () => fileInput.click();
          actionButtons.appendChild(btn);
        } else if (state === "start_camera") {
          // Start Camera Button
          const camBtn = document.createElement("button");
          camBtn.className = "camera-btn";
          camBtn.innerHTML = "üì∑ Start Camera";
          camBtn.onclick = startCamera;
          actionButtons.appendChild(camBtn);

          // Fallback Upload
          const upBtn = document.createElement("button");
          upBtn.className = "upload-btn secondary-btn";
          upBtn.textContent = "Upload Image Instead";
          upBtn.onclick = () => fileInput.click();
          actionButtons.appendChild(upBtn);
        } else if (state === "capture") {
          // Capture Button
          const capBtn = document.createElement("button");
          capBtn.className = "camera-btn";
          capBtn.innerHTML = "‚ö™ Capture Photo";
          capBtn.style.background = "#e74c3c"; // Red for recording/capture
          capBtn.onclick = capturePhoto;
          actionButtons.appendChild(capBtn);
        } else if (state === "upload") {
          // Final Upload Button
          const upBtn = document.createElement("button");
          upBtn.className = "upload-btn";
          upBtn.textContent = "‚úÖ Verify & Upload";
          upBtn.onclick = uploadDocument;
          actionButtons.appendChild(upBtn);

          // Retake Button
          const retakeBtn = document.createElement("button");
          retakeBtn.className = "upload-btn secondary-btn";
          retakeBtn.textContent = "‚Ü∫ Retake";
          retakeBtn.onclick = () => {
            previewContainer.classList.remove("active");
            if (currentUploadType === "selfie") startCamera();
            else {
              resetUploadUI();
              renderButtons("default");
            }
          };
          actionButtons.appendChild(retakeBtn);
        }
      }

      async function startCamera() {
        try {
          uploadArea.style.display = "none";
          cameraContainer.classList.add("active");

          stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "user" },
          });
          video.srcObject = stream;
          renderButtons("capture");
        } catch (err) {
          alert("Camera access denied or not available. Please upload a file.");
          resetUploadUI();
          renderButtons("default");
        }
      }

      function stopCamera() {
        if (stream) {
          stream.getTracks().forEach((track) => track.stop());
          stream = null;
        }
      }

      function capturePhoto() {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);

        // Stop video
        stopCamera();
        cameraContainer.classList.remove("active");

        // Convert to file
        canvas.toBlob((blob) => {
          selectedFile = new File([blob], "selfie.jpg", { type: "image/jpeg" });
          previewImage.src = URL.createObjectURL(blob);
          previewContainer.classList.add("active");
          renderButtons("upload");
        }, "image/jpeg");
      }

      function resetUploadUI() {
        stopCamera();
        cameraContainer.classList.remove("active");
        previewContainer.classList.remove("active");
        uploadArea.style.display = "block";
        selectedFile = null;
      }

      function hideUploadSection() {
        document.getElementById("uploadSection").classList.remove("active");
        resetUploadUI();
      }

      async function uploadDocument() {
        if (!selectedFile || !sessionId) return;

        // UI Feedback
        const btn = document.querySelector(".upload-btn"); // Get current upload button
        const originalText = btn.textContent;
        btn.disabled = true;
        btn.innerHTML =
          '<span style="animation:spin 1s infinite linear;display:inline-block">‚Üª</span> Verifying...';
        previewContainer.classList.add("scanning"); // Start scan animation

        const formData = new FormData();
        formData.append("session_id", sessionId);

        let endpoint = "/upload_pan_card/";
        if (currentUploadType === "selfie") {
          formData.append("selfie_image", selectedFile);
          endpoint = "/upload_selfie/";
        } else if (currentUploadType === "salary_slip") {
          formData.append("salary_slip", selectedFile);
          endpoint = "/upload_salary_slip/";
        } else {
          formData.append("pan_card_image", selectedFile);
        }

        try {
          const response = await fetch(endpoint, {
            method: "POST",
            body: formData,
          });
          const data = await response.json();

          previewContainer.classList.remove("scanning");

          if (data.verified || data.success) {
            showVerificationStatus("success", data.message);
            if (data.next_message)
              setTimeout(() => addMessage(data.next_message, "agent"), 1000);
            setTimeout(() => {
              hideUploadSection();
              if (data.sanction_letter_url)
                showLoanApproval(data.sanction_letter_url);
            }, 2000);
          } else {
            showVerificationStatus(
              "error",
              data.message || "Verification Failed"
            );
            btn.textContent = originalText;
            btn.disabled = false;
          }
        } catch (error) {
          previewContainer.classList.remove("scanning");
          showVerificationStatus("error", "Upload failed.");
          btn.textContent = originalText;
          btn.disabled = false;
        }
      }

      function showVerificationStatus(type, message) {
        const container = document.getElementById("messagesContainer");
        const div = document.createElement("div");
        div.className = `verification-status ${type}`;
        div.innerHTML = `<span>${
          type === "success" ? "‚úÖ" : "‚ö†Ô∏è"
        }</span> ${message}`;
        container.insertBefore(div, document.getElementById("typingIndicator"));
        container.scrollTop = container.scrollHeight;
      }

      function showLoanApproval(url) {
        const container = document.getElementById("messagesContainer");
        const div = document.createElement("div");
        div.className = "loan-approved";
        div.innerHTML = `
                <h3>üéâ Loan Approved!</h3>
                <p>Congratulations, your application is successful.</p>
                <a href="${url}" class="download-btn" download>üì• Download Sanction Letter</a>
            `;
        container.appendChild(div);
        container.scrollTop = container.scrollHeight;
      }
    </script>
  </body>
</html>
